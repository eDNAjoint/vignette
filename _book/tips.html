<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 8 Tips | eDNAjoint: an R package for interpreting paired or semi-paired environmental DNA and traditional survey data in a Bayesian framework</title>
  <meta name="description" content="Chapter 8 Tips | eDNAjoint: an R package for interpreting paired or semi-paired environmental DNA and traditional survey data in a Bayesian framework" />
  <meta name="generator" content="bookdown 0.39 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 8 Tips | eDNAjoint: an R package for interpreting paired or semi-paired environmental DNA and traditional survey data in a Bayesian framework" />
  <meta property="og:type" content="book" />
  <meta property="og:image" content="https://bookdown.org/abigailkeller/eDNAjoint/images/eDNAjoint_logo.png" />
  
  <meta name="github-repo" content="abigailkeller/eDNAjoint" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 8 Tips | eDNAjoint: an R package for interpreting paired or semi-paired environmental DNA and traditional survey data in a Bayesian framework" />
  
  
  <meta name="twitter:image" content="https://bookdown.org/abigailkeller/eDNAjoint/images/eDNAjoint_logo.png" />




  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="model.html"/>
<link rel="next" href="citation.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">eDNAjoint</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a></li>
<li class="chapter" data-level="2" data-path="installation.html"><a href="installation.html"><i class="fa fa-check"></i><b>2</b> Installation</a></li>
<li class="chapter" data-level="3" data-path="usecase1.html"><a href="usecase1.html"><i class="fa fa-check"></i><b>3</b> Use case 1: basic use of <code>jointModel()</code></a>
<ul>
<li class="chapter" data-level="3.1" data-path="usecase1.html"><a href="usecase1.html#prepare-the-data"><i class="fa fa-check"></i><b>3.1</b> Prepare the data</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="usecase1.html"><a href="usecase1.html#longtowide"><i class="fa fa-check"></i><b>3.1.1</b> Converting data from long to wide</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="usecase1.html"><a href="usecase1.html#fit-the-model"><i class="fa fa-check"></i><b>3.2</b> Fit the model</a></li>
<li class="chapter" data-level="3.3" data-path="usecase1.html"><a href="usecase1.html#model-selection"><i class="fa fa-check"></i><b>3.3</b> Model selection</a></li>
<li class="chapter" data-level="3.4" data-path="usecase1.html"><a href="usecase1.html#interpret-the-output"><i class="fa fa-check"></i><b>3.4</b> Interpret the output</a>
<ul>
<li class="chapter" data-level="3.4.1" data-path="usecase1.html"><a href="usecase1.html#summarize-posterior-distributions"><i class="fa fa-check"></i><b>3.4.1</b> Summarize posterior distributions</a></li>
<li class="chapter" data-level="3.4.2" data-path="usecase1.html"><a href="usecase1.html#effort-necessary-to-detect-presence"><i class="fa fa-check"></i><b>3.4.2</b> Effort necessary to detect presence</a></li>
<li class="chapter" data-level="3.4.3" data-path="usecase1.html"><a href="usecase1.html#calculate-mu_critical"><i class="fa fa-check"></i><b>3.4.3</b> Calculate <span class="math inline">\(\mu_{critical}\)</span></a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path="usecase1.html"><a href="usecase1.html#prior-sensitivity-analysis"><i class="fa fa-check"></i><b>3.5</b> Prior sensitivity analysis</a></li>
<li class="chapter" data-level="3.6" data-path="usecase1.html"><a href="usecase1.html#initialvalues1"><i class="fa fa-check"></i><b>3.6</b> Initial values</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="usecase2.html"><a href="usecase2.html"><i class="fa fa-check"></i><b>4</b> Use case 2: <code>jointModel()</code> with site-level covariates</a>
<ul>
<li class="chapter" data-level="4.1" data-path="usecase2.html"><a href="usecase2.html#fit-the-model-1"><i class="fa fa-check"></i><b>4.1</b> Fit the model</a></li>
<li class="chapter" data-level="4.2" data-path="usecase2.html"><a href="usecase2.html#model-selection-1"><i class="fa fa-check"></i><b>4.2</b> Model selection</a></li>
<li class="chapter" data-level="4.3" data-path="usecase2.html"><a href="usecase2.html#interpret-the-output-1"><i class="fa fa-check"></i><b>4.3</b> Interpret the output</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="usecase2.html"><a href="usecase2.html#summarize-posterior-distributions-1"><i class="fa fa-check"></i><b>4.3.1</b> Summarize posterior distributions</a></li>
<li class="chapter" data-level="4.3.2" data-path="usecase2.html"><a href="usecase2.html#effort-necessary-to-detect-presence-1"><i class="fa fa-check"></i><b>4.3.2</b> Effort necessary to detect presence</a></li>
<li class="chapter" data-level="4.3.3" data-path="usecase2.html"><a href="usecase2.html#calculate-mu_critical-1"><i class="fa fa-check"></i><b>4.3.3</b> Calculate <span class="math inline">\(\mu_{critical}\)</span></a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="usecase2.html"><a href="usecase2.html#initialvalues2"><i class="fa fa-check"></i><b>4.4</b> Initial values</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="usecase3.html"><a href="usecase3.html"><i class="fa fa-check"></i><b>5</b> Use case 3: <code>jointModel()</code> with multiple traditional gear types</a>
<ul>
<li class="chapter" data-level="5.1" data-path="usecase3.html"><a href="usecase3.html#prepare-the-data-1"><i class="fa fa-check"></i><b>5.1</b> Prepare the data</a></li>
<li class="chapter" data-level="5.2" data-path="usecase3.html"><a href="usecase3.html#fit-the-model-2"><i class="fa fa-check"></i><b>5.2</b> Fit the model</a></li>
<li class="chapter" data-level="5.3" data-path="usecase3.html"><a href="usecase3.html#model-selection-2"><i class="fa fa-check"></i><b>5.3</b> Model selection</a></li>
<li class="chapter" data-level="5.4" data-path="usecase3.html"><a href="usecase3.html#interpret-the-output-2"><i class="fa fa-check"></i><b>5.4</b> Interpret the output</a>
<ul>
<li class="chapter" data-level="5.4.1" data-path="usecase3.html"><a href="usecase3.html#summarize-posterior-distributions-2"><i class="fa fa-check"></i><b>5.4.1</b> Summarize posterior distributions</a></li>
<li class="chapter" data-level="5.4.2" data-path="usecase3.html"><a href="usecase3.html#effort-necessary-to-detect-presence-2"><i class="fa fa-check"></i><b>5.4.2</b> Effort necessary to detect presence</a></li>
<li class="chapter" data-level="5.4.3" data-path="usecase3.html"><a href="usecase3.html#calculate-mu_critical-2"><i class="fa fa-check"></i><b>5.4.3</b> Calculate <span class="math inline">\(\mu_{critical}\)</span></a></li>
</ul></li>
<li class="chapter" data-level="5.5" data-path="usecase3.html"><a href="usecase3.html#traditionalmodel"><i class="fa fa-check"></i><b>5.5</b> traditionalModel()</a></li>
<li class="chapter" data-level="5.6" data-path="usecase3.html"><a href="usecase3.html#initialvalues3"><i class="fa fa-check"></i><b>5.6</b> Initial values</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="usecase4.html"><a href="usecase4.html"><i class="fa fa-check"></i><b>6</b> Use case 4: <code>jointModel()</code> with semi-paired data</a>
<ul>
<li class="chapter" data-level="6.1" data-path="usecase4.html"><a href="usecase4.html#simulate-semi-paired-data"><i class="fa fa-check"></i><b>6.1</b> Simulate semi-paired data</a></li>
<li class="chapter" data-level="6.2" data-path="usecase4.html"><a href="usecase4.html#prepare-the-data-2"><i class="fa fa-check"></i><b>6.2</b> Prepare the data</a></li>
<li class="chapter" data-level="6.3" data-path="usecase4.html"><a href="usecase4.html#fit-the-model-3"><i class="fa fa-check"></i><b>6.3</b> Fit the model</a></li>
<li class="chapter" data-level="6.4" data-path="usecase4.html"><a href="usecase4.html#interpret-the-output-3"><i class="fa fa-check"></i><b>6.4</b> Interpret the output</a>
<ul>
<li class="chapter" data-level="6.4.1" data-path="usecase4.html"><a href="usecase4.html#summarize-posterior-distributions-3"><i class="fa fa-check"></i><b>6.4.1</b> Summarize posterior distributions</a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="usecase4.html"><a href="usecase4.html#initialvalues4"><i class="fa fa-check"></i><b>6.5</b> Initial values</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="model.html"><a href="model.html"><i class="fa fa-check"></i><b>7</b> The model</a>
<ul>
<li class="chapter" data-level="7.1" data-path="model.html"><a href="model.html#modeldescription"><i class="fa fa-check"></i><b>7.1</b> Model description</a></li>
<li class="chapter" data-level="7.2" data-path="model.html"><a href="model.html#bayesian-modeling-stan"><i class="fa fa-check"></i><b>7.2</b> Bayesian modeling: Stan</a></li>
<li class="chapter" data-level="7.3" data-path="model.html"><a href="model.html#priors"><i class="fa fa-check"></i><b>7.3</b> Priors</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="tips.html"><a href="tips.html"><i class="fa fa-check"></i><b>8</b> Tips</a>
<ul>
<li class="chapter" data-level="8.1" data-path="tips.html"><a href="tips.html#visualization-tips"><i class="fa fa-check"></i><b>8.1</b> Visualization tips</a>
<ul>
<li class="chapter" data-level="8.1.1" data-path="tips.html"><a href="tips.html#posterior-samples"><i class="fa fa-check"></i><b>8.1.1</b> Posterior samples</a></li>
<li class="chapter" data-level="8.1.2" data-path="tips.html"><a href="tips.html#chain-convergence"><i class="fa fa-check"></i><b>8.1.2</b> Chain convergence</a></li>
<li class="chapter" data-level="8.1.3" data-path="tips.html"><a href="tips.html#shinystan"><i class="fa fa-check"></i><b>8.1.3</b> Shinystan</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="tips.html"><a href="tips.html#troubleshooting-tips"><i class="fa fa-check"></i><b>8.2</b> Troubleshooting tips</a>
<ul>
<li class="chapter" data-level="8.2.1" data-path="tips.html"><a href="tips.html#quick-tips"><i class="fa fa-check"></i><b>8.2.1</b> Quick tips</a></li>
<li class="chapter" data-level="8.2.2" data-path="tips.html"><a href="tips.html#initial-values"><i class="fa fa-check"></i><b>8.2.2</b> Initial values</a></li>
<li class="chapter" data-level="8.2.3" data-path="tips.html"><a href="tips.html#changing-priors"><i class="fa fa-check"></i><b>8.2.3</b> Changing priors</a></li>
<li class="chapter" data-level="8.2.4" data-path="tips.html"><a href="tips.html#adding-site-level-covariates"><i class="fa fa-check"></i><b>8.2.4</b> Adding site-level covariates</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="9" data-path="citation.html"><a href="citation.html"><i class="fa fa-check"></i><b>9</b> Citation</a></li>
<li class="chapter" data-level="10" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i><b>10</b> References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">eDNAjoint: an R package for interpreting paired or semi-paired environmental DNA and traditional survey data in a Bayesian framework</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="tips" class="section level1 hasAnchor" number="8">
<h1><span class="header-section-number">Chapter 8</span> Tips<a href="tips.html#tips" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="visualization-tips" class="section level2 hasAnchor" number="8.1">
<h2><span class="header-section-number">8.1</span> Visualization tips<a href="tips.html#visualization-tips" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Running <code>jointModel()</code> with <code>eDNAjoint</code> returns an object of class <code>stanfit</code> and can be accessed and interpreted using all functions in the <a href="https://mc-stan.org/rstan/">rstan</a> package.</p>
<p>Here are a few examples of how to visualize your MCMC samples.</p>
<div class="sourceCode" id="cb116"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb116-1"><a href="tips.html#cb116-1" tabindex="-1"></a><span class="co"># run the joint model</span></span>
<span id="cb116-2"><a href="tips.html#cb116-2" tabindex="-1"></a><span class="fu">library</span>(eDNAjoint)</span>
<span id="cb116-3"><a href="tips.html#cb116-3" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">jointModel</span>(<span class="at">data =</span> gobyData, <span class="at">family =</span> <span class="st">&#39;poisson&#39;</span>, </span>
<span id="cb116-4"><a href="tips.html#cb116-4" tabindex="-1"></a>                  <span class="at">p10priors =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">20</span>), <span class="at">q=</span><span class="cn">FALSE</span>)</span></code></pre></div>
<div id="posterior-samples" class="section level3 hasAnchor" number="8.1.1">
<h3><span class="header-section-number">8.1.1</span> Posterior samples<a href="tips.html#posterior-samples" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>We can use the <code>bayesplot</code> package to examine the posterior distributions.</p>
<p>First, let’s look at the posterior distribution for <span class="math inline">\(p_{10}\)</span>.</p>
<div class="sourceCode" id="cb117"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb117-1"><a href="tips.html#cb117-1" tabindex="-1"></a><span class="fu">library</span>(bayesplot)</span>
<span id="cb117-2"><a href="tips.html#cb117-2" tabindex="-1"></a><span class="co"># plot posterior distribution, highlighting median and 80% credibility interval</span></span>
<span id="cb117-3"><a href="tips.html#cb117-3" tabindex="-1"></a><span class="fu">mcmc_areas</span>(<span class="fu">as.matrix</span>(fit<span class="sc">$</span>model), <span class="at">pars =</span> <span class="st">&#39;p10&#39;</span>, <span class="at">prob =</span> <span class="fl">0.8</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-76-1.png" width="672" /></p>
<p>We can also look at the posterior distributions of multiple parameters at once using <code>bayesplot</code>:</p>
<div class="sourceCode" id="cb118"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb118-1"><a href="tips.html#cb118-1" tabindex="-1"></a><span class="co"># plot posterior distribution, highlighting median and 90% credibility interval</span></span>
<span id="cb118-2"><a href="tips.html#cb118-2" tabindex="-1"></a><span class="fu">mcmc_areas</span>(<span class="fu">as.matrix</span>(fit<span class="sc">$</span>model), <span class="at">pars =</span> <span class="fu">c</span>(<span class="st">&#39;mu[1]&#39;</span>,<span class="st">&#39;mu[2]&#39;</span>), <span class="at">prob =</span> <span class="fl">0.9</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-77-1.png" width="672" /></p>
<p>And of course you can always plot the posterior samples using <code>ggplot</code>:</p>
<div class="sourceCode" id="cb119"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb119-1"><a href="tips.html#cb119-1" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb119-2"><a href="tips.html#cb119-2" tabindex="-1"></a></span>
<span id="cb119-3"><a href="tips.html#cb119-3" tabindex="-1"></a><span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb119-4"><a href="tips.html#cb119-4" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="at">x=</span><span class="fu">as.matrix</span>(fit<span class="sc">$</span>model)[,<span class="st">&#39;beta&#39;</span>]))<span class="sc">+</span></span>
<span id="cb119-5"><a href="tips.html#cb119-5" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span><span class="st">&#39;beta estimate&#39;</span>, <span class="at">y=</span><span class="st">&#39;count&#39;</span>)<span class="sc">+</span></span>
<span id="cb119-6"><a href="tips.html#cb119-6" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-78-1.png" width="672" /></p>
</div>
<div id="chain-convergence" class="section level3 hasAnchor" number="8.1.2">
<h3><span class="header-section-number">8.1.2</span> Chain convergence<a href="tips.html#chain-convergence" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The <code>bayesplot</code> package can also be used to examine chain convergence for <span class="math inline">\(p_{10}\)</span> and <span class="math inline">\(\mu_{i=1}\)</span>.</p>
<div class="sourceCode" id="cb120"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb120-1"><a href="tips.html#cb120-1" tabindex="-1"></a><span class="co"># this will plot the MCMC chains for p10 and mu at site 1</span></span>
<span id="cb120-2"><a href="tips.html#cb120-2" tabindex="-1"></a><span class="fu">mcmc_trace</span>(rstan<span class="sc">::</span><span class="fu">extract</span>(fit<span class="sc">$</span>model, <span class="at">permuted =</span> <span class="cn">FALSE</span>), <span class="at">pars =</span> <span class="fu">c</span>(<span class="st">&#39;p10&#39;</span>, <span class="st">&#39;mu[1]&#39;</span>))</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-79-1.png" width="672" /></p>
<p>This plot shows that our chains are well mixed.</p>
<p>We can also use <code>ggplot</code> to plot the chains:</p>
<div class="sourceCode" id="cb121"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb121-1"><a href="tips.html#cb121-1" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb121-2"><a href="tips.html#cb121-2" tabindex="-1"></a></span>
<span id="cb121-3"><a href="tips.html#cb121-3" tabindex="-1"></a><span class="co"># get chains for param p10</span></span>
<span id="cb121-4"><a href="tips.html#cb121-4" tabindex="-1"></a>chain1_p10 <span class="ot">&lt;-</span> <span class="fu">as.array</span>(fit<span class="sc">$</span>model)[,<span class="st">&#39;chain:1&#39;</span>,<span class="st">&#39;p10&#39;</span>]</span>
<span id="cb121-5"><a href="tips.html#cb121-5" tabindex="-1"></a>chain2_p10 <span class="ot">&lt;-</span> <span class="fu">as.array</span>(fit<span class="sc">$</span>model)[,<span class="st">&#39;chain:2&#39;</span>,<span class="st">&#39;p10&#39;</span>]</span>
<span id="cb121-6"><a href="tips.html#cb121-6" tabindex="-1"></a>chain3_p10 <span class="ot">&lt;-</span> <span class="fu">as.array</span>(fit<span class="sc">$</span>model)[,<span class="st">&#39;chain:3&#39;</span>,<span class="st">&#39;p10&#39;</span>]</span>
<span id="cb121-7"><a href="tips.html#cb121-7" tabindex="-1"></a>chain4_p10 <span class="ot">&lt;-</span> <span class="fu">as.array</span>(fit<span class="sc">$</span>model)[,<span class="st">&#39;chain:4&#39;</span>,<span class="st">&#39;p10&#39;</span>]</span>
<span id="cb121-8"><a href="tips.html#cb121-8" tabindex="-1"></a></span>
<span id="cb121-9"><a href="tips.html#cb121-9" tabindex="-1"></a><span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb121-10"><a href="tips.html#cb121-10" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x=</span><span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(chain1_p10), <span class="at">y=</span>chain1_p10), </span>
<span id="cb121-11"><a href="tips.html#cb121-11" tabindex="-1"></a>            <span class="at">color =</span> <span class="st">&#39;dodgerblue&#39;</span>)<span class="sc">+</span></span>
<span id="cb121-12"><a href="tips.html#cb121-12" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x=</span><span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(chain2_p10), <span class="at">y=</span>chain2_p10), </span>
<span id="cb121-13"><a href="tips.html#cb121-13" tabindex="-1"></a>            <span class="at">color =</span> <span class="st">&#39;firebrick&#39;</span>)<span class="sc">+</span></span>
<span id="cb121-14"><a href="tips.html#cb121-14" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x=</span><span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(chain3_p10), <span class="at">y=</span>chain3_p10), </span>
<span id="cb121-15"><a href="tips.html#cb121-15" tabindex="-1"></a>            <span class="at">color =</span> <span class="st">&#39;violet&#39;</span>)<span class="sc">+</span></span>
<span id="cb121-16"><a href="tips.html#cb121-16" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x=</span><span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(chain4_p10), <span class="at">y=</span>chain4_p10), </span>
<span id="cb121-17"><a href="tips.html#cb121-17" tabindex="-1"></a>            <span class="at">color =</span> <span class="st">&#39;goldenrod&#39;</span>)<span class="sc">+</span></span>
<span id="cb121-18"><a href="tips.html#cb121-18" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span><span class="st">&#39;iteration&#39;</span>, <span class="at">y=</span><span class="st">&#39;p10 estimate&#39;</span>)<span class="sc">+</span></span>
<span id="cb121-19"><a href="tips.html#cb121-19" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-80-1.png" width="672" /></p>
</div>
<div id="shinystan" class="section level3 hasAnchor" number="8.1.3">
<h3><span class="header-section-number">8.1.3</span> Shinystan<a href="tips.html#shinystan" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><a href="https://mc-stan.org/shinystan/">Shinystan</a> is also a great way to visualize your model fit and diagnose any problems.</p>
<p>Here’s how you would use the package:</p>
<div class="sourceCode" id="cb122"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb122-1"><a href="tips.html#cb122-1" tabindex="-1"></a><span class="fu">library</span>(shinystan)</span>
<span id="cb122-2"><a href="tips.html#cb122-2" tabindex="-1"></a></span>
<span id="cb122-3"><a href="tips.html#cb122-3" tabindex="-1"></a><span class="co"># launch shiny stan</span></span>
<span id="cb122-4"><a href="tips.html#cb122-4" tabindex="-1"></a><span class="fu">launch_shinystan</span>(fit<span class="sc">$</span>model)</span></code></pre></div>
<p>Note that you will see the log likelihoods and derivative parameters not found in the <a href="model.html#modeldescription">model description</a>, but you should focus on parameters present in <a href="index.html#intro">table 1</a>.</p>
</div>
</div>
<div id="troubleshooting-tips" class="section level2 hasAnchor" number="8.2">
<h2><span class="header-section-number">8.2</span> Troubleshooting tips<a href="tips.html#troubleshooting-tips" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>When running <code>jointModel()</code> are your chains not converging? Or are you getting <a href="https://mc-stan.org/docs/2_19/reference-manual/divergent-transitions">divergent transitions</a>? Here are some tips:</p>
<div id="quick-tips" class="section level3 hasAnchor" number="8.2.1">
<h3><span class="header-section-number">8.2.1</span> Quick tips<a href="tips.html#quick-tips" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ol style="list-style-type: decimal">
<li>Increase the <code>adapt_delta</code> parameter in <code>jointModel()</code>. This governs how big the steps are in the MCMC, so if the steps are too big, then divergent transitions can happen (see more on this <a href="https://mc-stan.org/rstanarm/reference/adapt_delta.html">here</a>). You could increase this value to something like 0.99 (closer to 1), although this will slow down sampling.</li>
<li>Test out different families to describe the data-generating process for the traditional survey data. The default in <code>jointModel()</code> is a poisson distribution, which assumes that the variance equals the mean. Try <code>family = 'negbin'</code>, which uses a negative binomial distribution and allows for overdispersed traditional survey data (i.e., variance &gt; mean).</li>
<li>Increase the number of burn-in samples with the <code>n.iter.burn</code> parameter in <code>jointModel()</code>. These burn-in samples are the MCMC “warm-up”, so by increasing the length of the warm-up, you could avoid getting divergent transitions during the actual sampling.</li>
</ol>
</div>
<div id="initial-values" class="section level3 hasAnchor" number="8.2.2">
<h3><span class="header-section-number">8.2.2</span> Initial values<a href="tips.html#initial-values" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The MCMC algorithm begins sampling at initial values for all the parameters. Sometimes problems can arise if 1) the MCMC starts sampling at parameter values that are far from the true parameter values, which will cause the adaptation to get funky, or 2) if the MCMC starts sampling at parameter values that are invalid, or where the likelihood of the parameter values given the data is 0.</p>
<p>Try setting better initial values for the MCMC. For guidance on how to set initial values, refer to the initial values sections for the <a href="usecase1.html#initialvalues1">basic</a>, <a href="usecase2.html#initialvalues2">site-level covariates</a>, <a href="usecase3.html#initialvalues3">multiple gear types</a>, and <a href="usecase4.html#initialvalues4">semi-paired data</a> examples.</p>
</div>
<div id="changing-priors" class="section level3 hasAnchor" number="8.2.3">
<h3><span class="header-section-number">8.2.3</span> Changing priors<a href="tips.html#changing-priors" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The model uses a somewhat-informative prior distribution for the false positive probability of an eDNA detection, <span class="math inline">\(p_{10}\)</span>. If you are having convergence issues, you can try making this prior more informative.</p>
<p>The default prior is <code>p10priors = c(1,20)</code>, which describes the <a href="https://en.wikipedia.org/wiki/Beta_distribution">beta distribution</a> hyperparameters: alpha, beta. The mean of this distribution is <span class="math inline">\(\frac{\alpha}{\alpha + \beta}\)</span>, and the variance of this distribution is <span class="math inline">\(\frac{\alpha\beta}{(\alpha + \beta)^2(\alpha+\beta+1)}\)</span>. The mean and variance of the default prior is 0.048 and 0.0002, respectively.</p>
<div class="sourceCode" id="cb123"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb123-1"><a href="tips.html#cb123-1" tabindex="-1"></a><span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb123-2"><a href="tips.html#cb123-2" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="at">x=</span><span class="fu">rbeta</span>(<span class="at">n=</span><span class="dv">10000</span>, <span class="at">shape1=</span><span class="dv">1</span>, <span class="at">shape2=</span><span class="dv">20</span>)))<span class="sc">+</span></span>
<span id="cb123-3"><a href="tips.html#cb123-3" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span><span class="st">&#39;p10 prior&#39;</span>,<span class="at">y=</span><span class="st">&#39;&#39;</span>)<span class="sc">+</span></span>
<span id="cb123-4"><a href="tips.html#cb123-4" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-82-1.png" width="672" /></p>
<p>If you wanted to add a more informative prior to reflect your belief that the probability of a false positive eDNA detection is low, you could change these parameter to something like <code>p10prior=c(1,50)</code>, where the mean and variance are 0.014 and 0.00019, respectively.</p>
<div class="sourceCode" id="cb124"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb124-1"><a href="tips.html#cb124-1" tabindex="-1"></a><span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb124-2"><a href="tips.html#cb124-2" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="at">x=</span><span class="fu">rbeta</span>(<span class="at">n=</span><span class="dv">10000</span>, <span class="at">shape1=</span><span class="dv">1</span>, <span class="at">shape2=</span><span class="dv">70</span>)))<span class="sc">+</span></span>
<span id="cb124-3"><a href="tips.html#cb124-3" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span><span class="st">&#39;p10 prior&#39;</span>,<span class="at">y=</span><span class="st">&#39;&#39;</span>)<span class="sc">+</span></span>
<span id="cb124-4"><a href="tips.html#cb124-4" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-83-1.png" width="672" /></p>
<p>Put another way, this choice of prior has 97% of its probability density &lt;0.05:</p>
<div class="sourceCode" id="cb125"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb125-1"><a href="tips.html#cb125-1" tabindex="-1"></a><span class="fu">pbeta</span>(<span class="at">q=</span><span class="fl">0.05</span>, <span class="at">shape1=</span><span class="dv">1</span>, <span class="at">shape2=</span><span class="dv">70</span>)</span></code></pre></div>
<pre><code>## [1] 0.9724163</code></pre>
<p>You can also set this prior using your own data, perhaps from negative controls. For example, let’s say you used 25 negative qPCR controls during eDNA data processing. You can assume that the probability of a false positive is less than <span class="math inline">\(\frac{1}{25} = 0.04\)</span>. To reflect this data, you could create a prior where the probability <span class="math inline">\(p_{10}&gt;0.04\)</span> is low, like <code>p10priors=c(1,100)</code>.</p>
<div class="sourceCode" id="cb127"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb127-1"><a href="tips.html#cb127-1" tabindex="-1"></a><span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb127-2"><a href="tips.html#cb127-2" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="at">x=</span><span class="fu">rbeta</span>(<span class="at">n=</span><span class="dv">10000</span>, <span class="at">shape1=</span><span class="dv">1</span>, <span class="at">shape2=</span><span class="dv">100</span>)))<span class="sc">+</span></span>
<span id="cb127-3"><a href="tips.html#cb127-3" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span><span class="st">&#39;p10 prior&#39;</span>,<span class="at">y=</span><span class="st">&#39;&#39;</span>)<span class="sc">+</span></span>
<span id="cb127-4"><a href="tips.html#cb127-4" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-85-1.png" width="672" /></p>
</div>
<div id="adding-site-level-covariates" class="section level3 hasAnchor" number="8.2.4">
<h3><span class="header-section-number">8.2.4</span> Adding site-level covariates<a href="tips.html#adding-site-level-covariates" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The model assumes that the site-level mean count and site-level mean eDNA detection rate are generally positively correlated. For example, let’s look at the relationship between the mean count and mean positive eDNA detections in the green crab data.</p>
<div class="sourceCode" id="cb128"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb128-1"><a href="tips.html#cb128-1" tabindex="-1"></a><span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb128-2"><a href="tips.html#cb128-2" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x=</span><span class="fu">rowMeans</span>(greencrabData<span class="sc">$</span>count, <span class="at">na.rm=</span><span class="cn">TRUE</span>),</span>
<span id="cb128-3"><a href="tips.html#cb128-3" tabindex="-1"></a>                 <span class="at">y=</span><span class="fu">rowMeans</span>(greencrabData<span class="sc">$</span>qPCR.K, <span class="at">na.rm=</span><span class="cn">TRUE</span>)),</span>
<span id="cb128-4"><a href="tips.html#cb128-4" tabindex="-1"></a>             <span class="at">size=</span><span class="dv">3</span>)<span class="sc">+</span></span>
<span id="cb128-5"><a href="tips.html#cb128-5" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span><span class="st">&#39;mean trap count&#39;</span>,<span class="at">y=</span><span class="st">&#39;mean positive eDNA detections&#39;</span>)<span class="sc">+</span></span>
<span id="cb128-6"><a href="tips.html#cb128-6" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-86-1.png" width="672" /></p>
<p>Or perhaps let’s look at the goby data, where the mean positive eDNA detections asymptotically approaches the number of eDNA replicates (6) as the site-level mean seine count increases.</p>
<div class="sourceCode" id="cb129"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb129-1"><a href="tips.html#cb129-1" tabindex="-1"></a><span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb129-2"><a href="tips.html#cb129-2" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x=</span><span class="fu">rowMeans</span>(gobyData<span class="sc">$</span>count, <span class="at">na.rm=</span><span class="cn">TRUE</span>),</span>
<span id="cb129-3"><a href="tips.html#cb129-3" tabindex="-1"></a>                 <span class="at">y=</span><span class="fu">rowMeans</span>(gobyData<span class="sc">$</span>qPCR.K, <span class="at">na.rm=</span><span class="cn">TRUE</span>)),</span>
<span id="cb129-4"><a href="tips.html#cb129-4" tabindex="-1"></a>             <span class="at">size=</span><span class="dv">3</span>)<span class="sc">+</span></span>
<span id="cb129-5"><a href="tips.html#cb129-5" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span><span class="st">&#39;mean seine count&#39;</span>,<span class="at">y=</span><span class="st">&#39;mean positive eDNA detections&#39;</span>)<span class="sc">+</span></span>
<span id="cb129-6"><a href="tips.html#cb129-6" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-87-1.png" width="672" /></p>
<p>If your data does not show a similar relationship and is not converging with <code>jointModel()</code>, then consider adding site-level covariates that can explain why the sensitivities between eDNA and traditional sampling do not have the same relationship across all sites. These site-level covariates can be quantitative or categorical (i.e., dummy variables). For example, are some of your sites ponds and others rivers? Is salinity higher at some of your sites? Are some sites particularly turbid? See <a href="usecase2.html#usecase2">use case 2</a> for an example of how to implement <code>jointModel()</code> with site-level covariates.</p>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="model.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="citation.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": null,
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["_main.pdf", "_main.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
